<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>CHORE CHART</title>
    <link rel="stylesheet" href="css/styles.css" type="text/css"/>
</head>
<body>

<div class="container" id="to-print" style="width: 750px;">
    <div class="printed">
        <form name="save-chore" id="save-chore" method="post" class="chore-form">
            <div class="egis2-logo">
            <span>
                <img src="images/egis2.png">
            </span>
            </div>
            <div class="chore-chart">
                <div class="header">
                    <img src="images/chorecharts.jpg"/>
                </div>
                <div class="chart-table">
                    <table>
                        <thead>
                        <tr>
                            <th>Chore</th>
                            <th>Sunday</th>
                            <th>Monday</th>
                            <th>Tuesday</th>
                            <th>Wednesday</th>
                            <th>Thursday</th>
                            <th>Friday</th>
                            <th>Saturday</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td>
                                <input type="text" class="subject-input" name="subject-1-name" id="subject-1-name" value="Spelling"/>
                                <input type="text" class="description-input" name="desc-1-name" id="desc-1-name" value="(video, CW & HW)"/>

                            </td>
                            <td>
                                <div class="checkbox">
                                    <input type="checkbox" id="sun-spelling" name="sun-spelling"/>
                                    <label for="sun-spelling">
                                        <span>&nbsp;</span>
                                    </label>
                                </div>
                            </td>
                            <td>
                                <div class="checkbox">
                                    <input type="checkbox" id="mon-spelling" name="mon-spelling"/>
                                    <label for="mon-spelling"></label>
                                </div>
                            </td>
                            <td>
                                <div class="checkbox">
                                    <input type="checkbox" id="tue-spelling" name="tue-spelling"/>
                                    <label for="tue-spelling">
                                        <span>&nbsp;</span>
                                    </label>
                                </div>
                            </td>
                            <td>
                                <div class="checkbox">
                                    <input type="checkbox" id="wed-spelling" name="wed-spelling"/>
                                    <label for="wed-spelling">
                                        <span>&nbsp;</span>
                                    </label>
                                </div>
                            </td>
                            <td>
                                <div class="checkbox">
                                    <input type="checkbox" id="thu-spelling" name="thu-spelling"/>
                                    <label for="thu-spelling">
                                        <span>&nbsp;</span>
                                    </label>
                                </div>
                            </td>
                            <td valign="top" rowspan="5" colspan="2">
                                <h5>Revision & reading Practice</h5>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input type="text" class="subject-input" name="subject-2-name" id="subject-2-name" value="Grammar"/>
                                <input type="text" class="description-input" name="desc-2-name" id="desc-2-name" value="(video, CW & HW)"/>
                            </td>
                            <td>
                                <div class="checkbox">
                                    <input type="checkbox" id="sun-grammar" name="sun-grammar"/>
                                    <label for="sun-grammar">
                                        <span>&nbsp;</span>
                                    </label>
                                </div>
                            </td>
                            <td>
                                <div class="checkbox">
                                    <input type="checkbox" id="mon-grammar" name="mon-grammar"/>
                                    <label for="mon-grammar">
                                        <span>&nbsp;</span>
                                    </label>
                                </div>
                            </td>
                            <td>
                                <div class="checkbox">
                                    <input type="checkbox" id="tue-grammar" name="tue-grammar"/>
                                    <label for="tue-grammar">
                                        <span>&nbsp;</span>
                                    </label>
                                </div>
                            </td>
                            <td>
                                <div class="checkbox">
                                    <input type="checkbox" id="wed-grammar" name="wed-grammar"/>
                                    <label for="wed-grammar">
                                        <span>&nbsp;</span>
                                    </label>
                                </div>
                            </td>
                            <td>
                                <div class="checkbox">
                                    <input type="checkbox" id="thu-grammar" name="thu-grammar"/>
                                    <label for="thu-grammar">
                                        <span>&nbsp;</span>
                                    </label>
                                </div>
                            </td>

                        </tr>
                        <tr>
                            <td>
                                <input type="text" class="subject-input" name="subject-3-name" id="subject-3-name" value="Reading"/>
                                <input type="text" class="description-input" name="desc-3-name" id="desc-3-name" value="(video, CW & HW)"/>
                            </td>
                            <td>
                                <div class="checkbox">
                                    <input type="checkbox" id="sun-reading" name="sun-reading"/>
                                    <label for="sun-reading">
                                        <span>&nbsp;</span>
                                    </label>
                                </div>
                            </td>
                            <td>
                                <div class="checkbox">
                                    <input type="checkbox" id="mon-reading" name="mon-reading"/>
                                    <label for="mon-reading">
                                        <span>&nbsp;</span>
                                    </label>
                                </div>
                            </td>
                            <td>
                                <div class="checkbox">
                                    <input type="checkbox" id="tue-reading" name="tue-reading"/>
                                    <label for="tue-reading">
                                        <span>&nbsp;</span>
                                    </label>
                                </div>
                            </td>
                            <td>
                                <div class="checkbox">
                                    <input type="checkbox" id="wed-reading" name="wed-reading"/>
                                    <label for="wed-reading">
                                        <span>&nbsp;</span>
                                    </label>
                                </div>
                            </td>
                            <td>
                                <div class="checkbox">
                                    <input type="checkbox" id="thu-reading" name="thu-reading"/>
                                    <label for="thu-reading">
                                        <span>&nbsp;</span>
                                    </label>
                                </div>
                            </td>

                        </tr>
                        <tr>
                            <td>
                                <input type="text" class="subject-input" name="subject-4-name" id="subject-4-name" value="Writing"/>
                                <input type="text" class="description-input" name="desc-4-name" id="desc-4-name" value="(video, CW & HW)"/>
                            </td>
                            <td>
                                <div class="checkbox">
                                    <input type="checkbox" id="sun-writing" name="sun-writing"/>
                                    <label for="sun-writing">
                                        <span>&nbsp;</span>
                                    </label>
                                </div>
                            </td>
                            <td>
                                <div class="checkbox">
                                    <input type="checkbox" id="mon-writing" name="mon-writing"/>
                                    <label for="mon-writing">
                                        <span>&nbsp;</span>
                                    </label>
                                </div>
                            </td>
                            <td>
                                <div class="checkbox">
                                    <input type="checkbox" id="tue-writing" name="tue-writing"/>
                                    <label for="tue-writing">
                                        <span>&nbsp;</span>
                                    </label>
                                </div>
                            </td>
                            <td>
                                <div class="checkbox">
                                    <input type="checkbox" id="wed-writing" name="wed-writing"/>
                                    <label for="wed-writing">
                                        <span>&nbsp;</span>
                                    </label>
                                </div>
                            </td>
                            <td>
                                <div class="checkbox">
                                    <input type="checkbox" id="thu-writing" name="thu-writing"/>
                                    <label for="thu-writing">
                                        <span>&nbsp;</span>
                                    </label>
                                </div>
                            </td>

                        </tr>
                        <tr>
                            <td>
                                <input type="text" class="subject-input" name="subject-5-name" id="subject-5-name" value="Social Studies"/>
                                <input type="text" class="description-input" name="desc-5-name" id="desc-5-name" value="(video, CW & HW)"/>
                            </td>
                            <td>
                                <div class="checkbox">
                                    <input type="checkbox" id="sun-social" name="sun-social"/>
                                    <label for="sun-social">
                                        <span>&nbsp;</span>
                                    </label>
                                </div>
                            </td>
                            <td>
                                <div class="checkbox">
                                    <input type="checkbox" id="mon-social" name="mon-social"/>
                                    <label for="mon-social">
                                        <span>&nbsp;</span>
                                    </label>
                                </div>
                            </td>
                            <td>
                                <div class="checkbox">
                                    <input type="checkbox" id="tue-social" name="tue-social"/>
                                    <label for="tue-social">
                                        <span>&nbsp;</span>
                                    </label>
                                </div>
                            </td>
                            <td>
                                <div class="checkbox">
                                    <input type="checkbox" id="wed-social" name="wed-social"/>
                                    <label for="wed-social">
                                        <span>&nbsp;</span>
                                    </label>
                                </div>
                            </td>
                            <td>
                                <div class="checkbox">
                                    <input type="checkbox" id="thu-social" name="thu-social"/>
                                    <label for="thu-social">
                                        <span>&nbsp;</span>
                                    </label>
                                </div>
                            </td>

                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="smiley-text">
                <span>
                    <img src="images/smile.svg">
                </span>
                    <div>
                        <h1>Put smiley face</h1>
                        <p>How many smiles can you get? Put them on the chart!</p>
                    </div>

                    <span>
                    <img src="images/smile.svg">
                </span>
                </div>
                <div class="name">
                    <span>Name:</span>
                    <input type="text" placeholder="" id="name-input" name="name-input" value=""/>
                </div>
            </div>
        </form>
    </div>
</div>
<div class="status">
    <span></span>
</div>
<div class="print-btn">
    <div>
        <button class="submit">Save Chore</button>
        <button class="reset">Clear Chore</button>
    </div>

    <button class="print" onclick="downloadChart('to-print')">Download Chore Chart</button>
</div>

<div class="rating-stars">
    <span data-value="1">
        <img src="images/star-F.svg" alt="Bad" title="Bad"/>
    </span>
    <span data-value="2">
        <img src="images/star-B.svg" alt="Acceptable" title="Acceptable"/>
    </span>
    <span data-value="3">
        <img src="images/star-A.svg" alt="Good" title="Good"/>
    </span>
    <span data-value="4">
        <img src="images/star-A+.svg" alt="Excellent" title="Excellent"/>
    </span>
    <span data-value="5">
        <img src="images/star.svg" alt="Happy" title="Happy"/>
    </span>
    <span data-value="trophy">
        <img src="images/trophy.svg" alt="Trophy" title="Trophy"/>
    </span>
    <span data-value="love">
        <img src="images/love.svg" alt="Love" title="Love"/>
    </span>
    <span data-value="happy">
        <img src="images/smile.svg" alt="Happy" title="Happy"/>
    </span>
    <span data-value="sad">
        <img src="images/sad.svg" alt="Sad" title="Sad"/>
    </span>
    <span data-value="angry">
        <img src="images/angry.svg" alt="Angry" title="Angry"/>
    </span>

</div>
</body>
<script src="js/jquery-3.5.1.min.js" type="text/javascript"></script>
<script src="js/dom-to-image.js" type="text/javascript"></script>
<script src="js/FileSaver.js" type="text/javascript"></script>
<script src="js/js.cookie.min.js" type="text/javascript"></script>


<script>
    function downloadChart(id) {
        var node = document.getElementById(id);
        var name = document.getElementById('name-input').value;
        var date = new Date().toJSON().slice(0,10);
        domtoimage.toBlob(node)
            .then(function (blob) {
                window.saveAs(blob, name +"-"+ date);
            });
    }
</script>
<script>
    $(function(){


        $(document).click(function(e){
            //$('.rating-stars').removeClass('show');
        })
        var mX, mY, isOn = false;
        $(document).mousemove(function (e) {
            mX = e.pageX;
            mY = e.pageY;
        }).mouseover();

        $(document).mouseup(function(e)
        {
            var container =$('.rating-stars');
            // if the target of the click isn't the container nor a descendant of the container
            if (!container.is(e.target) && container.has(e.target).length === 0)
            {
                container.removeClass('show');
            }
        });



        $('.checkbox input').click(function (e) {
            var $this = $(this),
                info = $('.rating-stars');
            $('.checkbox').removeClass('active');
            $this.parents('.checkbox').addClass('active');
            if ($this.is(':checked')){
                $this.addClass('checked');
                info.addClass('show').animate({
                    'left': mX - 20,
                    'top': mY + 30
                });
            }
            else{
                $this.removeClass('checked');
                info.removeClass('show')
            }

        });

        $('.rating-stars span').click(function(e){
            var selectedRate = $(this).data('value');
            $('.checkbox.active input ').attr('value', selectedRate );
            $('.rating-stars').removeClass('show');
        })

        // serialize form input to send it to cookies
        $('.submit').click(function (){
            var dataString = $('.chore-form').serialize();
            Cookies.set('choreCookies', dataString);
            $('.status').addClass('success show').find('span').text('Your Chore Chart has been saved successfully.');

            setTimeout(function(){
                $('.status').removeClass('show success')
            },3000)

        })
        $('.reset').click(function(){
            Cookies.remove('choreCookies');
            $('.status').addClass('error show').find('span').text('Your Chore Chart has been cleared successfully.');
                $('.checkbox input').val('on').prop('checked', false);
            setTimeout(function(){
                $('.status').removeClass('show error')
            },3000)
        })


        // Read cookies once page load
        cookieData = Cookies.get('choreCookies');
        console.log(cookieData)
        // if cookie exists continue
        if (cookieData != null) {
            // split cookieData string into an array of fields and their values
            var cookieArray = cookieData.split('&');
            // go through each field and split it too to get field name and it's value
            $.each(cookieArray, function(k, v) {
                var field = v.split('=');
                // populate field with data
                $('.chore-form').find('#'+field[0]).val(field[1]);
            });
        }

        // check all checkbox that already selected
        $('.checkbox input').each(function(i,e){
            var $val = $(e).val();
            console.log($val)

            if($val != 'on' ){
                $(this).attr('checked', 'checked');
            }
        })

        // relace %20 in name to be space


        String.prototype.replaceAll = function(search, replacement) {
            var target = this;
            return target.replace(new RegExp(search, 'g'), replacement);
        };

        function replaceAll(str, map){
            for(key in map){
                str = str.replaceAll(key, map[key]);
            }
            return str;
        }
        var map = {
            '%20' : ' ',
            '%2C' : ',',
            '%26' : '&'
        };

        var name = $('#name-input').val();
        $('#name-input').val(replaceAll(name, map));

        $('.subject-input, .description-input').each(function(i,e){
              //  var subjectName = $(e).val().replace(/%20/g, " ").replace(/%2C/g,",").replace(/%26/g,"&");
                var subjectName = $(e).val();
                $(e).val(replaceAll(subjectName, map));
            })
    })

</script>

</html>
